name: AHK v2 Compile - Emergency

on: [push, workflow_dispatch]

jobs:
  emergency-compile:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ULTIMATIVE Kompilierung
      shell: cmd
      run: |
        echo === START EMERGENCY COMPILE ===
        echo.
        echo 1. Repository Inhalt:
        dir /s /b
        
        echo.
        echo 2. Suche AutoReSizer.ahk
        if exist "AutoReSizer.ahk" (
          echo ✅ AutoReSizer.ahk gefunden
          echo Größe: %~zAutoReSizer.ahk% Bytes
        ) else (
          echo ❌ AutoReSizer.ahk NICHT GEFUNDEN
          exit /b 1
        )
        
        echo.
        echo 3. Lade AutoHotkey v2
        curl -L "https://github.com/AutoHotkey/AutoHotkey/releases/download/v2.0.11/AutoHotkey_2.0.11.zip" -o "ahk2.zip"
        
        echo.
        echo 4. Entpacke
        powershell -Command "Expand-Archive -Path 'ahk2.zip' -DestinationPath 'ahk2' -Force"
        
        echo.
        echo 5. Suche Compiler
        dir ahk2 /s
        
        echo.
        echo 6. MANUELLE KOMPILIERUNG
        for /r ahk2 %%i in (Ahk2Exe.exe) do set "AHK2EXE=%%i"
        for /r ahk2 %%i in (AutoHotkey64.exe) do set "AHK64=%%i"
        
        echo Compiler: %AHK2EXE%
        echo Base File: %AHK64%
        
        echo.
        echo 7. Kompiliere
        "%AHK2EXE%" /in "AutoReSizer.ahk" /out "AutoReSizer.exe" /bin "%AHK64%"
        
        echo.
        echo 8. Prüfe Ergebnis
        if exist "AutoReSizer.exe" (
          echo ✅✅✅ ERFOLG! AutoReSizer.exe wurde erstellt!
          dir AutoReSizer.exe
        ) else (
          echo ❌❌❌ FEHLGESCHLAGEN
          echo Erstelle Dummy-File für Debugging
          copy "%AHK64%" "AutoReSizer.exe"
        )
        
    - name: Hochladen
      uses: actions/upload-artifact@v4
      with:
        name: COMPILED-EXE
        path: AutoReSizer.exe
