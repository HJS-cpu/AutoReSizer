name: Compile AHK v2 Script
on: [push, workflow_dispatch]

jobs:
  compile:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup AHK v2
        run: |
          # Download
          curl -LO https://github.com/AutoHotkey/AutoHotkey/releases/download/v2.0.11/AutoHotkey_2.0.11.zip
          
          # Extract
          tar -xf AutoHotkey_2.0.11.zip || 7z x AutoHotkey_2.0.11.zip -oahk
          
          # Find files
          find . -name "Ahk2Exe.exe" -type f
          find . -name "AutoHotkey64.exe" -type f
          
      - name: Compile
        run: |
          # Set paths
          AHK2EXE=$(find . -name "Ahk2Exe.exe" -type f | head -1)
          AHK64=$(find . -name "AutoHotkey64.exe" -type f | head -1)
          
          echo "Using: $AHK2EXE"
          echo "Base: $AHK64"
          
          # Compile
          "$AHK2EXE" //in "AutoReSizer.ahk" //out "AutoReSizer.exe" //bin "$AHK64"
          
          # Check
          if [ -f "AutoReSizer.exe" ]; then
            echo "✅ Success!"
            ls -la "AutoReSizer.exe"
          else
            echo "❌ Failed!"
            exit 1
          fi
          
      - uses: actions/upload-artifact@v4
        with:
          name: AutoReSizer
          path: AutoReSizer.exe
